var initStartX = 0;
var initStartY = 0;

var rect = {
    startX: 0,
    startY: 0,
    width: 0,
    height: 0
}

function touchstart(event, ins) {
    if (!event.currentTarget.dataset.isrubber) return;

    var touch = event.touches[0] || event.changedTouches[0];
    var parentNodeOffset = event.currentTarget;
    initStartX = touch.pageX - parentNodeOffset.offsetLeft;
    initStartY = touch.pageY - parentNodeOffset.offsetTop;

    ins.selectComponent('.rubber-box').setStyle({
        left: initStartX + 'px',
        top: initStartY + 'px'
    });
}

function touchmove(event, ins) {
    if (!event.currentTarget.dataset.isrubber) return;

    var touch = event.touches[0] || event.changedTouches[0];
    var parentNodeOffset = event.currentTarget;
    var moveToX = touch.pageX - parentNodeOffset.offsetLeft;
    var moveToY = touch.pageY - parentNodeOffset.offsetTop;
    var startX = Math.min(moveToX, initStartX);
    var startY = Math.min(moveToY, initStartY);
    var width = Math.abs(moveToX - initStartX);
    var height = Math.abs(moveToY - initStartY);
    
    ins.selectComponent('.rubber-box').setStyle({
        left: startX + 'px',
        top: startY + 'px',
        width: width + 'px',
        height: height + 'px'
    });

    setRect(startX, startY, width, height);
}

function touchend(event, ins) {
    if (!event.currentTarget.dataset.isrubber) return;

    ins.callMethod('rubberEnd', rect);
    ins.selectComponent('.rubber-box').setStyle({
        left: 0,
        top: 0,
        width: 0,
        height: 0
    });
}

function setRect (startX, startY, width, height) {
    rect.startX = startX;
    rect.startY = startY;
    rect.width = width;
    rect.height = height;
}

module.exports = {
    touchstart: touchstart,
    touchmove: touchmove,
    touchend: touchend
}